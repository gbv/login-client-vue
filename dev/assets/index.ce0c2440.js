var e=Object.defineProperty,n=Object.prototype.hasOwnProperty,l=Object.getOwnPropertySymbols,o=Object.prototype.propertyIsEnumerable,t=(n,l,o)=>l in n?e(n,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[l]=o;import{d as a,r,a as i,i as u,w as s,c,b as d,e as p,v,f as g,g as w,t as m,h as b,F as f,j as h,o as k,k as y,l as L,L as U,m as C,n as S,p as R,q as I,s as O,u as _}from"./vendor.9a4e915f.js";!function(e=".",n="__import__"){try{self[n]=new Function("u","return import(u)")}catch(l){const o=new URL(e,location),t=e=>{URL.revokeObjectURL(e.src),e.remove()};self[n]=e=>new Promise(((l,a)=>{const r=new URL(e,o);if(self[n].moduleMap[r])return l(self[n].moduleMap[r]);const i=new Blob([`import * as m from '${r}';`,`${n}.moduleMap['${r}']=m;`],{type:"text/javascript"}),u=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(i),onerror(){a(new Error(`Failed to import: ${e}`)),t(u)},onload(){l(self[n].moduleMap[r]),t(u)}});document.head.appendChild(u)})),self[n].moduleMap={}}}("/login-client-vue/dev/assets/");const j=a({name:"App",setup(){const e=new URLSearchParams(window.location.search),n=r(e.get("server")||"coli-conc.gbv.de/login/"),l=r(!e.has("ssl")||"true"===e.get("ssl")),o=r(""),t=i(u("login"));return t.connect(n.value,{ssl:l.value}),s((()=>t.user),(e=>{o.value=e&&e.name||""})),{url:n,ssl:l,name:o,login:t,version:"0.0.2",commit:"e9d6612",branch:"dev",connect(){t.connect(n.value,{ssl:l.value});const e=new URLSearchParams(window.location.search);e.set("server",n.value),e.set("ssl",l.value),window.history.replaceState({},"",`${window.location.href.replace(window.location.search,"")}?${e.toString()}`)}}}}),$=d("div",{style:{clear:"both"}},null,-1),x=d("h1",null," login-client-vue ",-1),W=d("b",null,"Connection:",-1),T=d("br",null,null,-1),P=d("br",null,null,-1),E=d("label",{for:"sslCheckbox"},"SSL",-1),M=d("br",null,null,-1),B=d("b",null,"Status:",-1),N=d("br",null,null,-1),F=d("br",null,null,-1),V=d("br",null,null,-1),q=d("br",null,null,-1),A=d("br",null,null,-1),D={key:0},z=d("br",null,null,-1),G=d("br",null,null,-1),H={key:1},J=d("br",null,null,-1),K={key:2},Q=d("hr",null,null,-1);j.render=function(e,n,l,o,t,a){const r=h("user-status");return k(),c(f,null,[d("nav",null,[d(r,{redirect:!0,style:{float:"right"}}),$]),d("main",null,[x,d("section",null,[d("p",null,[W,T,p(d("input",{"onUpdate:modelValue":n[1]||(n[1]=n=>e.url=n),type:"text",placeholder:"Login Server URL (without protocol)"},null,512),[[v,e.url]]),P,p(d("input",{id:"sslCheckbox","onUpdate:modelValue":n[2]||(n[2]=n=>e.ssl=n),type:"checkbox"},null,512),[[g,e.ssl]]),E,M,d("button",{onClick:n[3]||(n[3]=(...n)=>e.connect&&e.connect(...n))}," Connect ")]),d("p",null,[B,N,w(" Connected: "+m(e.login.connected),1),F,w(" Logged in: "+m(e.login.loggedIn),1),V,w(" User: "+m(e.login.user&&e.login.user.name),1),q,w(" Token: "+m(e.login.token?"✅":"❌"),1),A,e.login.loggedIn?(k(),c("span",D,[p(d("input",{"onUpdate:modelValue":n[4]||(n[4]=n=>e.name=n),type:"text",placeholder:"Name"},null,512),[[v,e.name]]),d("button",{onClick:n[5]||(n[5]=n=>e.login.setName(e.name))}," Set name "),z,d("button",{onClick:n[6]||(n[6]=n=>e.login.openLogoutWindow())}," Logout "),G])):(k(),c("span",H,[d("button",{onClick:n[7]||(n[7]=n=>e.login.openLoginWindow())}," Login "),J])),e.login.connected?(k(),c("span",K,[d("button",{onClick:n[8]||(n[8]=n=>e.login.disconnect())}," Disconnect ")])):b("",!0)])]),Q,d("footer",null," login-client-vue version "+m(e.version)+" ("+m(e.branch)+" - "+m(e.commit)+") ",1)])],64)};const X=r(!1),Y=y(X),Z=r(null),ee=y(Z),ne=L((()=>null!==ee.value)),le=r(null),oe=y(le),te=r([]),ae=y(te),re=r(null),ie=y(re),ue=r(null),se=y(ue);let ce;const de=U.events,pe=U.errors;function ve(e,n={}){le.value&&le.value.disconnect(),le.value=new U(e,n),le.value.connect(),le.value.addEventListener(null,(e=>{var n;switch(n=e.type,ge.window&&ge.eventType==n&&setTimeout((()=>{ge.window&&ge.window.close(),ge.window=null}),100),e.type){case de.connect:X.value=!0;break;case de.disconnect:X.value=!1;break;case de.login:Z.value=e.user;break;case de.logout:Z.value=null,ue.value=null;break;case de.update:Z.value=e.user;break;case de.providers:te.value=e.providers;break;case de.about:re.value=e;break;case de.token:ue.value=e.token,clearTimeout(ce),ce=setTimeout((()=>{ue.value=null}),1e3*e.expiresIn)}}))}const ge={window:null,eventType:null};const we={connected:Y,user:ee,loggedIn:ne,connect:ve,disconnect:function(){le.value&&le.value.connected&&le.value.disconnect()},client:oe,providers:ae,about:ie,token:se,events:de,errors:pe,setName:function(e){oe.value&&oe.value.setName(e)},openLoginWindow:function({id:e,redirect:n=!1}={}){if(!oe.value)return;const l=oe.value._about,o=ae.value.find((({id:n})=>e===n)),t=o&&o.loginURL||l&&l.baseUrl+"login/";t&&(n?window.location.href=`${t}?redirect_uri=${encodeURIComponent(window.location.href)}`:(ge.window=window.open(t),ge.eventType=de.login))},openLogoutWindow:function({redirect:e=!1}={}){if(!oe.value||!oe.value.connected)return;const n=oe.value._about,l=n&&n.baseUrl+"logout/";l&&(e?window.location.href=`${l}?redirect_uri=${encodeURIComponent(window.location.href)}`:(ge.window=window.open(l),ge.eventType=de.logout))},openBaseWindow:function(){if(!oe.value||!oe.value.connected)return;const e=oe.value._about,n=e&&e.baseUrl;n&&window.open(n)}};var me=((e,a)=>{for(var r in a||(a={}))n.call(a,r)&&t(e,r,a[r]);if(l)for(var r of l(a))o.call(a,r)&&t(e,r,a[r]);return e})({install:(e,t={})=>{var{url:a}=t,r=((e,t)=>{var a={};for(var r in e)n.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&l)for(var r of l(e))t.indexOf(r)<0&&o.call(e,r)&&(a[r]=e[r]);return a})(t,["url"]);a&&ve(a,r),e.provide("login",we)}},we);const be=a({name:"UserStatus",props:{redirect:{type:Boolean,default:!1}},setup:()=>({login:i(me)})}),fe=R();I("data-v-ec9cc5b6");const he={class:"user-status"},ke=d("span",{class:"carret-down"},"▼",-1),ye={class:"user-status-dropdown"},Le={key:0},Ue=d("hr",null,null,-1),Ce=d("p",null," Sign in via ",-1);O();const Se=fe(((e,n,l,o,t,a)=>(k(),c("div",he,[d("a",{href:"",class:{"user-status-disconnected":!e.login.connected},onClick:n[1]||(n[1]=C((n=>e.login.loggedIn?e.login.openBaseWindow():e.login.openLoginWindow({redirect:e.redirect})),["prevent"]))},[w(m(e.login.loggedIn?e.login.user.name:"Sign in")+" ",1),ke],2),d("div",ye,[e.login.connected?e.login.loggedIn?(k(),c(f,{key:1},[d("p",null," Signed in as "+m(e.login.user.name)+". ",1),Ue,d("ul",null,[d("li",null,[d("a",{href:"",onClick:n[2]||(n[2]=C((n=>e.login.openLogoutWindow()),["prevent"]))}," Sign out ")])])],64)):(k(),c(f,{key:2},[Ce,d("ul",null,[(k(!0),c(f,null,S(e.login.providers,(n=>(k(),c("li",{key:n.id},[d("a",{href:"",onClick:C((l=>e.login.openLoginWindow({id:n.id,redirect:e.redirect})),["prevent"])},[n.image?(k(),c("img",{key:0,src:n.image},null,8,["src"])):b("",!0),w(" "+m(n.name),1)],8,["onClick"])])))),128))])],64)):(k(),c("p",Le," Error: Could not connect to Login Server. "))])]))));be.render=Se,be.__scopeId="data-v-ec9cc5b6",be.install=e=>{e.component(be.name,be)},_(j).use(me).use(be).mount("#app");
